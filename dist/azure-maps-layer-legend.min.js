/* MIT License - Copyright (c) Microsoft Corporation. */


!function(e,i){"use strict";var c="default"in i?i.default:i,n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)};function t(e,t){function a(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}var l=function(){return(l=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var o in t=arguments[a])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=(o.merge=function(e,t){for(var a=window||global,n=0,o=e.split(".");n<o.length;n++){var r=o[n];if(!a[r])return t;a=a[r]}return l(l({},a),t)},o);function o(){}var R=(s.getString=function(e,t,a,n){if(e){if("number"==typeof e)return e.toLocaleString(a,n);if(""!==e)return Number.toString(),t&&t[e]?t[e]:e}return""},s.uuid=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})},s.getLayer=function(e,t){return"string"==typeof e?t.layers.getLayerById(e):e},s.colorToRGBA=function(e){var t=document.createElement("canvas");t.setAttribute("width","1"),t.setAttribute("height","1");var a=t.getContext("2d");a.fillStyle=e,a.fillRect(0,0,1,1);var n=a.getImageData(0,0,1,1).data;return[n[0],n[1],n[2],n[3]]},s.getColorTheme=function(e){var t=s.colorToRGBA(e);return 127<Math.sqrt(.299*t[0]*t[0]+.587*t[1]*t[1]+.114*t[2]*t[2])?"light":"dark"},s.getElement=function(e){if(e){if("string"!=typeof e)return e;var t=document.getElementById(e);return t=t||document.querySelector(e)}return null},s.replacePlaceholder=function(e,t,a,n){n&&(t="[\"']?"+t+"[\"']?");var o=RegExp(t,"gi");return JSON.parse(JSON.stringify(e).replace(o,a+""))},s.setZoomRangeAttr=function(e,t,a){t.setAttribute("data-min-zoom",e.minZoom+""),t.setAttribute("data-max-zoom",e.maxZoom+""),a&&(a.setAttribute("data-min-zoom",e.minZoom+""),a.setAttribute("data-max-zoom",e.maxZoom+""))},s.processZoomRangeAttr=function(e,t,a){for(var n=0;n<e.length;n++){var o=e[n];if(o.hasAttribute("data-min-zoom")){var r=parseInt(o.getAttribute("data-min-zoom")),i=parseInt(o.getAttribute("data-max-zoom")),l=r<=t&&t<=i;if("hide"===a)o.style.display=l?"":"none";else{for(var s=o.querySelectorAll("input, option"),d=0;d<s.length;d++)s[d].disabled=!l;l?o.classList.remove("atlas-carousel-disabled-text"):o.classList.add("atlas-carousel-disabled-text")}}}},s.getZoomRange=function(e){if(e&&0<e.length){var a={minZoom:24,maxZoom:0};if(e.forEach(function(e){if(e.getOptions){var t=e.getOptions();a.minZoom=Math.min(t.minZoom||0,a.minZoom),a.maxZoom=Math.max(t.maxZoom||24,a.maxZoom)}}),a.minZoom>a.maxZoom){var t=a.maxZoom;a.maxZoom=a.minZoom,a.minZoom=t}return a}return{minZoom:0,maxZoom:24}},s.addClearDiv=function(e){var t=document.createElement("div");t.className="atlas-control-clear",e.appendChild(t)},s.measureText=function(e,t,a){var n=document.createElement("canvas").getContext("2d");return n.font=t+"px "+(a||"Arial"),n.measureText(e)},s.addStringDiv=function(e,t,a,n,o,r){if(t&&""!==t){if(""!==(t=s.getString(t,n))){var i=document.createElement("div");if(i.className=a,i.innerHTML=t,i.setAttribute("aria-label",t),e.appendChild(i),!r){var l=s.measureText(t,14);i.style.minWidth=Math.ceil(l.width+20)+"px"}o&&s.addClearDiv(e)}return t}return""},s.getNumber=function(e,t,a,n){var o=e[t];return"number"==typeof o?Math.max(a,o):n},s.getNumber2=function(e,t,a,n,o){var r=e[a];return"number"==typeof r||"number"==typeof(r=t[a])?Math.max(n,r):o},s);function s(){}var r,d=(t(m,r=i.internal.EventEmitter),m.prototype.onAdd=function(e,t){var a=this,n=(a._map=e).getStyle().language||c.getLanguage();n&&0<n.indexOf("-")&&(n=n.substring(0,n.indexOf("-")));var o=m._translations,r=o[n];r=r||o.en,a._localization=r,t&&(a._controlPosition=t.position);var i=document.createElement("div");i.classList.add("azure-maps-control-container"),a._cssClass&&i.classList.add(a._cssClass);var l=r[a._nameIdx];l&&i.setAttribute("aria-label",l),a._container=i;var s=e.getMapContainer().classList;if(s.contains("high-contrast-dark")?a._hclStyle="dark":s.contains("high-contrast-light")&&(a._hclStyle="light"),a._setStyle(a._baseOptions.style),a._rebuildContainer(),void 0!==a._baseOptions.visible){var d=a._baseOptions.visible?"":"none";a._container&&(a._container.style.display=d),a._content&&(a._content.style.display=d)}return e.events.add("zoomend",a._mapZoomChanged),a._mapZoomChanged(null),a._container},m.prototype.onRemove=function(){var e=this;e._content&&(e._content.remove(),e._content=null),e._container&&(e._container.remove(),e._container=null);var t=e._map;t&&(e._baseOptions.style.startsWith("auto")&&t.events.remove("styledata",e._mapStyleChanged),t.events.remove("zoomend",e._mapZoomChanged)),e._map=null},m.prototype.setOptions=function(e){e=e||{};var t=this,a=t._baseOptions,n=!1;if(void 0!==e.style&&(a.style=e.style,t._setStyle(e.style)),void 0!==e.zoomRangeBehavior&&(a.zoomRangeBehavior=e.zoomRangeBehavior,t._needsRebuild=!0),void 0!==e.visible){a.visible=e.visible;var o=e.visible?"":"none";t._container&&(t._container.style.display=o),t._content&&(t._content.style.display=o),n=!0}void 0!==e.minimized&&a.minimized!==e.minimized&&(a.minimized=e.minimized,t._setBtnState()),void 0!==e.container&&(a.minimized=!1,t._setBtnState(),a.container=e.container,t._needsRebuild=!0),void 0!==e.layout&&a.layout!==e.layout&&(a.layout=e.layout,t._needsRebuild=!0),void 0!==e.showToggle&&a.showToggle!==e.showToggle&&(a.showToggle=e.showToggle,e.showToggle||(e.minimized=!1),t._setBtnState()),t._needsRebuild&&t._map?t._rebuildContainer():n&&t._mapZoomChanged(null)},m.prototype._addCard=function(e,t,a,n){var o,r=this,i=r._content,l=r._baseOptions.layout;if("carousel"===l?((o=document.createElement("button")).className="atlas-carousel-dot",t.appendChild(o)):"accordion"===l&&((o=document.createElement("button")).className="atlas-accordion-button",o.innerHTML=n,i.appendChild(o)),i.appendChild(e),o){var s=e.getAttribute("rel");o.setAttribute("rel",s),o.setAttribute("aria-label",n),o.setAttribute("title",n),o.setAttribute("aria-controls",e.id),o.onclick=r._handledClicked.bind(r),r._currentIdx===parseInt(s)?(e.style.display="",o.setAttribute("aria-expanded","true"),o.classList.add("active")):(o.setAttribute("aria-expanded","false"),e.style.display="none")}R.setZoomRangeAttr(a,e,o)},m.prototype._rebuildContainer=function(){var e=this,t=e._baseOptions;if(e._createContent(),e._setStyle(t.style),t.visible||(e._container.style.display="none",e._content.style.display="none"),!t.container){e._btn&&e._btn.remove();var a={display:t.showToggle?"":"none",backgroundColor:e._bgColor},n=90,o=e._controlPosition;o&&"non-fixed"!==o||(o="top-left");var r=-1<o.indexOf("left");n=-1<o.indexOf("top")?(a.bottom="0",r?180:270):(a.top="0",r?90:0),r?a.right="0":a.left="0",a.transform="rotate("+n+"deg)",e._btnRotation=n;var i=document.createElement("button");i.setAttribute("type","button"),i.classList.add("atlas-layer-legend-expand-btn"),Object.assign(i.style,a),i.addEventListener("click",e._toggle),e._container.appendChild(i),e._btn=i,e._setBtnState()}if(e._mapZoomChanged(null),e._map){var l="unset",s="unset";if(!e._baseOptions.container){var d=e._map.getCanvasContainer().getClientRects()[0];s=.75*d.height+"px",l=d.width-20+"px"}Object.assign(e._container.style,{maxHeight:s,maxWidth:l})}},m.prototype._setStyle=function(e){if(e){var t=this,a=t._map;a&&(e.startsWith("auto")&&!t._hclStyle?(a.events.add("styledata",t._mapStyleChanged),t._setColorFromMapStyle()):(a.events.remove("styledata",t._mapStyleChanged),t._setControlColor(e)))}},m.prototype._setColorFromMapStyle=function(){var e=this,t="light";if(-1<["satellite","satellite_road_labels","grayscale_dark","night","high_contrast_dark"].indexOf(e._map.getStyle().style))t="dark";else if(-1===["road","grayscale_light","road_shaded_relief","blank","blank_accessible","high_contrast_light"].indexOf(e._map.getStyle().style))for(var a=e._map.map.getStyle(),n=0;n<a.length;n++){var o=a[n];if("background"===o.type){o.paint&&"string"==typeof o.paint["background-color"]&&(t=R.getColorTheme(o.paint["background-color"]));break}}"auto-reverse"===e._baseOptions.style&&(t="light"===t?"dark":"light"),e._setControlColor(t)},m.prototype._setControlColor=function(e){var t=this;if(t._container||t._content){e=t._hclStyle||e;var a=t._darkColor,n="white",o=a;"light"===e||"dark"===e||e.startsWith("auto")?"dark"===e&&(n=a,o="white"):(n=e,o="dark"===(e=R.getColorTheme(e))?"white":a);var r={backgroundColor:n,color:o};t._content&&Object.assign(t._content.style,r),t._container&&Object.assign(t._container.style,r),t._btn&&(t._btn.style.backgroundColor=n),t._fontColor=o,t._bgColor=n}},m.prototype._setCardIdx=function(e,t){var a=this;if(a._content){var n=a._content.getElementsByClassName("atlas-layer-legend-card"),o=a._content.querySelectorAll(".atlas-carousel-dot, .atlas-accordion-button"),r=a._baseOptions.layout;0===o.length&&(o=null),e>n.length&&(e=0),e<0&&"accordion"!==r&&(e=n.length),a._currentIdx=e;for(var i=0;i<n.length;i++){var l=n[i],s=parseInt(l.getAttribute("rel"));if("carousel"===r)s!==e?(l.style.display="none",o&&(o[i].classList.remove("atlas-carousel-dot-active"),o[i].setAttribute("aria-expanded","false"))):(l.style.display="block",o&&(o[i].classList.add("atlas-carousel-dot-active"),o[i].setAttribute("aria-expanded","true")),t&&a._setItemFocus(l));else if("accordion"===r)s!==e?(l.style.display="none",o&&(o[i].classList.remove("active"),o[i].setAttribute("aria-expanded","false"))):(l.style.display="block",o&&(o[i].classList.add("active"),o[i].setAttribute("aria-expanded","true")),t&&a._setItemFocus(l));else if(s===e){l.scrollIntoView(),t&&a._setItemFocus(l);break}}}},m.prototype._setItemFocus=function(e){var t=e.querySelectorAll("input, button, select, a");0<t.length&&t[0].focus()},m.prototype._setBtnState=function(){var e=this,t=e._btn,a=e._baseOptions;if(t&&!a.container){var n=e._btnCSS,o="32px",r="32px",i="none",l=e._btnRotation,s=!1,d=3,c=a.minimized&&a.showToggle;if(c?(s=!0,l=(l+180)%360,d=2):(i="",o=r="unset"),t.setAttribute("aria-expanded",!c+""),e._container){e._content&&a.visible&&(e._content.style.display=i);var m=e._container.classList;s?m.contains(n)||m.add(n):m.remove(n),t.style.transform="rotate("+l+"deg)",Object.assign(e._container.style,{height:r,width:o}),e._content&&a.visible&&(e._content.style.display=i)}var u=e._localization[d];t.setAttribute("title",u),t.setAttribute("alt",u),a.minimized!==c&&e._invokeEvent("toggled",{minimized:c,type:"toggled"})}},m._translations={en:["Legend control","Layer control","Expand","Collapse"],af:["Legende beheer","Laagbeheer","Uitbrei","Inval"],ar:["السيطرة على الأسطورة","التحكم في الطبقة","وسعت","انهيار"],eu:["Kondaira kontrol","Geruzaren kontrola","Hedatu","Erroiztu"],bg:["Контрол на легендата","Контрол на слоя","Разширяване","С колапс"],zh:["传说控制","层控制","扩张","坍塌"],hr:["Legenda kontrola","Kontrola sloja","Proširiti","Kolaps"],cs:["Kontrola legendy","Řízení vrstvy","Rozšířit","Kolaps"],da:["Legend Control.","Lagstyring","Udvide","Falde sammen"],nl:["Legend Control","Laagregeling","Uitbreiden","Instorten"],et:["Legendikontroll","Kihi juhtimine","Laiendama","Kollaps"],fi:["Legend Control","Kerrosohjaus","Laajentaa","Romahdus"],fr:["Lutte contre la légende","Contrôle de couche","Développer","Effondrer"],gl:["Control de lendas","Control de capa","Expandir.","Colapso"],de:["Legend Control.","Schichtregelung","Expandieren","Zusammenbruch"],el:["Έλεγχος θρύλου","Έλεγχος στρώματος","Επεκτείνουν","Κατάρρευση"],hi:["पौराणिक नियंत्रण","परत नियंत्रण","विस्तार करना","ढहने"],hu:["Legenda irányítás","Rétegszabályozás","Kiterjed","Összeomlás"],id:["Kontrol legenda","Kontrol lapisan","Mengembangkan","Jatuh"],it:["Controllo della legenda","Controllo del livello","Espandere","Crollo"],ja:["伝説のコントロール","レイヤコントロール","拡大","崩壊"],kk:["Аңызды бақылау","Қабатты бақылау","Кеңейту","Күйреу"],ko:["전설 제어","레이어 제어","확장하다","무너지다"],es:["Control de leyenda","Control de la capa","Expandir","Colapso"],lv:["Leģenda kontrole","Slāņa kontrole","Paplašināt","Sabrukums"],lt:["Legend Control.","Sluoksnio kontrolė","Išplėsti","Žlugimas"],ms:["Kawalan Legend.","Kawalan lapisan","Berkembang","Runtuh"],nb:["Legenden kontrollen","Lagkontroll","Utvide","Kollapse"],pl:["Kontrola legendy","Kontrola warstwy","Zwiększać","Zawalić się"],pt:["Controle da legenda","Controle de camada","Expandir","Colapso"],ro:["Controlul legendei","Controlul stratului","Extinde","Colaps"],ru:["Легендант контроля","Управление слоем","Расширять","Крах"],sr:["Контрола легенде","Контрола слоја","Проширити","Колапс"],sk:["Legenda","Ovládanie vrstvy","Rozbaľovať","Kolaps"],sl:["Legenda Control.","Kontrola plasti","Razširi","Spanje."],sv:["Legendkontroll","Lagkontroll","Bygga ut","Kollaps"],th:["การควบคุมตำนาน","การควบคุมเลเยอร์","ขยาย","ทรุด"],tr:["Efsane kontrolü","Katman kontrolü","Genişletmek","Yıkılmak"],uk:["Легенда контроль","Керування шаром","Розширювати","Розвал"],vi:["Kiểm soát huyền thoại","Lớp kiểm soát","Mở rộng","Sự sụp đổ"]},m);function m(e,t,a){var f=r.call(this)||this;f._needsRebuild=!1,f._rebuildOnStyleChange=!1,f._darkColor="#011c2c",f._baseOptions={layout:"carousel",style:"light",visible:!0,zoomRangeBehavior:"hide",showToggle:!0,minimized:!1},f._currentIdx=0,f._hasZoomableContent=!1,f._btnRotation=0,f._mapZoomChanged=function(e){var t=f,a=t._content,n=t._baseOptions;if(a)if(t._hasZoomableContent){for(var o=Math.round(t._map.getCamera().zoom),r=n.zoomRangeBehavior,i=void 0,l=a.getElementsByClassName("atlas-layer-legend-card"),s=a.querySelectorAll(".atlas-carousel-dot, .atlas-accordion-button"),d=0;d<l.length;d++){var c=l[d],m=parseInt(c.getAttribute("rel")),u=parseInt(c.getAttribute("data-min-zoom")),g=parseInt(c.getAttribute("data-max-zoom")),p=u<=o&&o<=g,h=p?"":"none";"hide"===r&&("carousel"===n.layout||"accordion"===n.layout?0<s.length&&(s[d].style.display=h):c.style.display=h),!p||void 0!==i&&m!==t._currentIdx||(i=m);var y=c.querySelectorAll("label, option");R.processZoomRangeAttr(y,o,r)}"hide"===r&&(n.visible&&!n.minimized&&(a.style.display=void 0===i?"none":""),t._currentIdx!==i&&t._setItemIndex(i,!0))}else n.visible&&!n.minimized&&(a.style.display="")},f._mapStyleChanged=function(){f._setColorFromMapStyle(),f._rebuildOnStyleChange&&f._rebuildContainer()},f._handledClicked=function(e){var t=f,a=e.target,n=parseInt(a.getAttribute("rel"));"accordion"===t._baseOptions.layout&&a.classList.contains("active")&&(n=-1),t._setItemIndex(n,!0)},f._toggle=function(){var e=f,t=e._baseOptions;t.minimized=!t.minimized,e._setBtnState()};var n=f;return n._nameIdx=e,n._cssClass=t,n._btnCSS=a,f}var u,g=(t(p,u=d),p.prototype.getOptions=function(){return Object.assign({},this._options)},p.prototype.setOptions=function(o){o=o||{};var r=this,i=r._options;Object.keys(o).forEach(function(e){var t=o[e];if(void 0!==t)switch(e){case"style":case"visible":case"container":case"layout":case"zoomRangeBehavior":i[e]=t;break;case"legends":var a=0;null!==(i[e]=t)&&r._currentLegend&&-1!==(a=t.indexOf(r._currentLegend))||(r._currentLegend=null,a=0),r._legendIdx=a;var n=!1;t.forEach(function(e){e.minZoom=R.getNumber(e,"minZoom",0,0),e.maxZoom=R.getNumber(e,"maxZoom",0,24),0===e.minZoom&&24===e.maxZoom||(n=!0)}),r._hasZoomableContent=n,t&&r.setLegendIdx(a),r._needsRebuild=!0;break;default:i[e]=t,r._needsRebuild=!0}}),u.prototype.setOptions.call(this,o)},p.prototype.setLegendIdx=function(e,t){this._setItemIndex(e,t)},p.prototype.add=function(e,t){var a=this,n=a._getLegendIdx(e);-1===n?(a._options.legends.push(e),focus&&(a._legendIdx=a._options.legends.length-1,a._currentLegend=e),e.minZoom=R.getNumber(e,"minZoom",0,0),e.maxZoom=R.getNumber(e,"maxZoom",0,24),0===e.minZoom&&24===e.maxZoom||(a._hasZoomableContent=!0),a._needsRebuild=!0,u.prototype.setOptions.call(this)):t&&a.setLegendIdx(n)},p.prototype.focus=function(e){var t=this._getLegendIdx(e);-1!==t&&this.setLegendIdx(t)},p.prototype.remove=function(e){var t=this,a=t._getLegendIdx(e),n=t._options.legends;-1<a&&n.length>a&&(t._legendIdx===a&&(1<n.length?(t._legendIdx=a-1,t._currentLegend=n[a-1]):(t._legendIdx=-1,t._currentLegend=null)),n.splice(a,1),t._needsRebuild=!0,u.prototype.setOptions.call(this))},p.prototype._setItemIndex=function(e,t){var a=this;if(a._content){a._setCardIdx(e,t),e=a._currentIdx;var n=a._options.legends,o=void 0!==e&&n.length>e?n[e]:null;a._currentLegend=o,a._invokeEvent("legendfocused",{legendIdx:e,legend:o,type:"legendfocused"})}},p.prototype._getLegendIdx=function(e){return this._options.legends.indexOf(e)},p.prototype._createContent=function(){var e=this,t=e._options,a=t.legends,n=t.resx||{},o=t.layout;e._content&&e._content.remove();var r=document.createElement("div");if(r.className="atlas-legend-control",e._content=r,R.addStringDiv(r,t.title,"atlas-legend-title",n,!0),a&&0<a.length){"carousel"!==o&&"accordion"!==o||r.classList.add("atlas-layer-legend-card-container");for(var i=document.createElement("div"),l=!(i.className="atlas-carousel-dot-container"),s=0;s<a.length;s++){var d=a[s];if(d){var c=R.uuid(),m=document.createElement("div");m.classList.add("atlas-layer-legend-card"),m.id=c,m.setAttribute("rel",s+"");var u=void 0;switch(u="accordion"===t.layout?R.getString(d.subtitle,n):R.addStringDiv(m,d.subtitle,"atlas-legend-subtitle",n,!0),d.type){case"category":e._createCategoryLegend(m,d,n);break;case"image":e._createImageLegend(m,d,n);break;case"html":e._createHtmlLegend(m,d);break;case"gradient":l=!0,e._createGradientLegend(m,d,n)}R.addStringDiv(m,d.footer,"atlas-legend-footer",n,!1,!0),e._addCard(m,i,d,u)}}e._rebuildOnStyleChange=l,"carousel"===o&&(1<i.children.length&&(R.addClearDiv(r),r.appendChild(i)),e.setLegendIdx(e._legendIdx))}var g=R.getElement(t.container);g?g.appendChild(r):e._container&&e._container.appendChild(r)},p.prototype._createCategoryLegend=function(e,c,m){if(c.items){var u=R.getNumber(c,"strokeWidth",0,1),g=20-2*u,p=document.createElement("div");p.classList.add("atlas-legend-category-legend"),c.cssClass&&p.classList.add(c.cssClass),c.layout&&(p.style.flexDirection=c.layout);var h=c.fitItems&&c.layout&&c.layout.startsWith("row")&&c.itemLayout&&c.itemLayout.startsWith("column"),y=0;if(c.items.forEach(function(e){var t=document.createElement("div");t.classList.add("atlas-legend-category-item"),t.style.flexDirection=c.itemLayout?c.itemLayout:"row";var a,n,o=e.color||c.color||"transparent",r=e.shape||c.shape||"circle";switch(r){case"line":a='<rect x="'+u+'" y="8" height="4" width="'+g+'" fill="'+o+'" stroke-width="'+u+'"/>';break;case"square":a='<rect x="'+u+'" y="'+u+'" height="'+g+'" width="'+g+'" fill="'+o+'" stroke-width="'+u+'"/>';break;case"triangle":a='<polygon points="'+u+" "+g+", "+g+" "+g+", "+.5*(g+u)+" "+u+'" fill="'+o+'" stroke-width="'+u+'"/>';break;case"circle":a='<circle cx="10" cy="10" r="'+(10-u)+'" fill="'+o+'" stroke-width="'+u+'"/>';break;default:n=/<svg/i.test(r)&&!/^data:/i.test(r)?"data:image/svg+xml;base64,"+window.btoa(r):r}var i=R.getNumber2(e,c,"shapeSize",1,20);y=Math.max(y,i);var l=document.createElement("div");a?l.innerHTML='<svg class="atlas-legend-category-shape" style="width:'+i+'px;" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">'+a+"</svg>":n&&(l.innerHTML='<img class="atlas-legend-category-shape" style="width:'+i+'px;" src="'+r+'"/>'),e.cssClass&&t.classList.add(e.cssClass),t.appendChild(l),h&&(Object.assign(l.style,{position:"relative"}),Object.assign(l.firstChild.style,{position:"absolute",top:0,bottom:0,left:0,right:0}));var s=R.getString(e.label,m,c.numberFormatLocales,c.numberFormat),d=document.createElement("span");d.innerHTML=s,d.setAttribute("aria-label",s),c.labelsOverlapShapes&&(d.style.position="absolute"),t.appendChild(d),p.appendChild(t)}),c.fitItems){var t=p.getElementsByClassName("atlas-legend-category-item"),a=y+"px",n={};h?n.height=a:n.width=a;var o=h||c.layout&&c.layout.startsWith("row")&&c.itemLayout&&c.itemLayout.startsWith("row");Array.prototype.forEach.call(t,function(e){o&&(n.width=e.firstChild.firstChild.style.width),Object.assign(e.firstChild.style,n)})}e.appendChild(p)}},p.prototype._createImageLegend=function(e,t,a){if(t.url){var n=document.createElement("div");n.classList.add("atlas-legend-image-legend"),t.cssClass&&n.classList.add(t.cssClass);var o=document.createElement("img"),r=R.getString(t.altText||t.subtitle,a);""!==r&&(o.setAttribute("alt",r),o.setAttribute("title",r)),o.onerror=function(){console.log("Unable to load legend image: "+t.url),n.remove()},t.maxHeight&&0<t.maxHeight&&(o.style.maxWidth=t.maxHeight+"px"),t.maxWidth&&0<t.maxWidth&&(o.style.maxWidth=t.maxWidth+"px"),o.src=t.url,n.appendChild(o),e.appendChild(n)}},p.prototype._createHtmlLegend=function(e,t){if(t.html){var a=document.createElement("div");t.cssClass&&a.classList.add(t.cssClass),"string"==typeof t.html?a.innerHTML=t.html:a.appendChild(t.html),e.appendChild(a)}},p.prototype._createGradientLegend=function(e,o,r){if(o.stops&&0<o.stops.length){var t=document.createElement("div");t.classList.add("atlas-legend-gradient-legend"),o.cssClass&&t.classList.add(o.cssClass);var a=this._fontColor,n=R.getNumber,i="vertical"===o.orientation,l=n(o,"fontSize",1,12),s=o.fontFamily||"'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif";s=s.replace(/"/g,"'");var d=n(o,"barThickness",1,20),c=n(o,"barLength",1,200),m=n(o,"tickSize",0,5),u=[],g=[],p=[],h=void 0,y=void 0,f=void 0,v=void 0,_=void 0,b=void 0,x=void 0,C=void 0;if(o.stops.sort(function(e,t){return e.offset-t.offset}),i){_='x1="0%" y1="0%" x2="0%" y2="100%" gradientTransform="rotate(180,0.5,0.5)"',b="fill:"+a+";font-size:"+l+"px;font-family:"+s+';text-align:center;text-anchor:start;dominant-baseline:middle;"',C=c;var L=0,S=(x=d)+3,k=S+m,E=k+3;0<m&&g.push('<line x1="'+S+'" y1="0" x2="'+S+'" y2="'+c+'" />'),o.stops.forEach(function(e){var t=e.color||"black";u.push('<stop offset="'+100*e.offset+'%" stop-color="'+t+'" />');var a=R.getString(e.label,r,o.numberFormatLocales,o.numberFormat);if(a&&""!==a){var n=c*(1-e.offset);0===e.offset?--n:1===e.offset&&(n+=1),0<m&&g.push('<line x1="'+S+'" y1="'+n+'" x2="'+k+'" y2="'+n+'" />'),p.push('<text x="'+E+'" y="'+n+'">'+a+"</text>"),L=Math.max(R.measureText(a,l,s).width,L)}}),y=h=Math.ceil(E+L),v=(f=c)+l}else{_='x1="0%" y1="0%" x2="100%" y2="0%"',b="fill:"+a+";font-size:"+l+"px;font-family:"+s+";text-align:center;text-anchor:middle;dominant-baseline:hanging;",x=c;var w=0,O=(C=d)+3,Z=O+m,I=Z+3;0<m&&g.push('<line x1="0" y1="'+O+'" x2="'+c+'" y2="'+O+'" />'),o.stops.forEach(function(e){var t=e.color||"black";u.push('<stop offset="'+100*e.offset+'%" stop-color="'+t+'" />');var a=R.getString(e.label,r,o.numberFormatLocales,o.numberFormat);if(a&&""!==a){var n=c*e.offset;1===e.offset?--n:0===e.offset&&(n+=1),0<m&&g.push('<line x1="'+n+'" y1="'+O+'" x2="'+n+'" y2="'+Z+'" />'),p.push('<text x="'+n+'" y="'+I+'">'+a+"</text>"),w=Math.max(R.measureText(a,l,s).width,w)}}),y=w+(h=c),v=f=I+(0<p.length?1.33*l:0)}var A=R.uuid(),z='\n                <svg width="'+y+'" height="'+v+'" viewBox="0 0 '+h+" "+f+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                    <defs>                    \n                        <pattern id="atlas-pattern-'+A+'" x="0" y="0" width="10" height="10" patternUnits="userSpaceOnUse">\n                            <rect x="0" y="0" width="10" height="10" fill="white"/>\n                            <rect x="0" y="0" width="5" height="5" fill="#ccc"/>\n                            <rect x="5" y="5" width="5" height="5" fill="#ccc"/>\n                        </pattern>\n\n                        <linearGradient id="atlas-gradient-'+A+'" '+_+">"+u.join("")+'</linearGradient>\n                    </defs>\n\n                    <rect x="0" y="0" width="'+x+'" height="'+C+'" fill="url(\'#atlas-pattern-'+A+'\')" />  \n                    <rect x="0" y="0" width="'+x+'" height="'+C+'" fill="url(\'#atlas-gradient-'+A+'\')" />\n\n                    <g style="stroke:'+a+';stroke-width:2;">'+g.join("")+'</g>\n\n                    <g style="'+b+'">'+p.join("")+"</g>\n                </svg>\n                ";t.innerHTML=z,e.appendChild(t)}},p);function p(e){var t=u.call(this,0,"atlas-legend-control-container","atlas-legend-btn")||this;return t._options={resx:{},layout:"carousel",style:"light",visible:!0,legends:[],zoomRangeBehavior:"hide",showToggle:!0,minimized:!1},t._legendIdx=0,t._currentLegend=null,t.setOptions(e),t}var h,y=(t(f,h=d),f.prototype.getOptions=function(){return this._options},f.prototype.setOptions=function(a){a=a||{};var n=this,o=n._options;Object.keys(a).forEach(function(e){var t=a[e];if(void 0!==t)switch(e){case"style":case"visible":case"container":case"layout":case"zoomRangeBehavior":o[e]=t;break;default:o[e]=t,n._needsRebuild=!0}}),h.prototype.setOptions.call(this,a)},f.prototype._setItemIndex=function(e,t){this._setCardIdx(e,t)},f.prototype._createContent=function(){var c=this,m=c._options,u=m.resx||{},g=m.layout,p=m.layerGroups;c._content&&c._content.remove();var e=document.createElement("div");if(e.className="atlas-layer-control",c._content=e,R.addStringDiv(e,m.title,"atlas-layer-title",u,!0),p&&0<p.length){for(var h=document.createElement("div"),y=!(h.className="atlas-carousel-dot-container"),t=function(e){var t=R.uuid(),n=p[e],a=R.getZoomRange(c._getAllAzLayers(null,n));n.minZoom=R.getNumber2(n,a,"minZoom",0,0),n.maxZoom=R.getNumber2(n,a,"maxZoom",0,24),0===n.minZoom&&24===n.maxZoom||(y=!0),n.items&&n.items.forEach(function(e){var t=c._getAllAzLayers(e,n);c._inflateLayerStateStyles(e,t);var a=R.getZoomRange(t);e.minZoom=Math.max(R.getNumber2(e,a,"minZoom",0,0),n.minZoom),e.maxZoom=Math.min(R.getNumber2(e,a,"maxZoom",0,24),n.maxZoom),0!==e.minZoom&&24!==e.maxZoom&&(y=!0)});var o=document.createElement("div");o.classList.add("atlas-layer-legend-card"),o.id=t,o.setAttribute("rel",e+"");var r=void 0;if(r="accordion"===g?R.getString(n.groupTitle,u):R.addStringDiv(o,n.groupTitle,"atlas-legend-group-title",u,!0),n.legends&&m.legendControl)for(var i=0;i<n.legends.length;i++){var l=n.legends[i];l.minZoom=R.getNumber2(l,n,"minZoom",0,0),l.maxZoom=R.getNumber2(l,n,"maxZoom",0,24),m.legendControl.add(l,0===i)}var s=n.layout||"checkbox",d=void 0;switch(s){case"dropdown":d=c._createDropdown(n,r);break;case"checkbox":case"radio":d=c._createChoiceGroup(s,n);break;case"range":d=c._createRange(n)}d&&o.appendChild(d),c._addCard(o,h,n,r)},a=0;a<p.length;a++)t(a);c._hasZoomableContent=y,"carousel"===g&&(1<h.children.length&&(R.addClearDiv(e),e.appendChild(h)),c._setCardIdx(0))}var n=R.getElement(m.container);n?n.appendChild(e):c._container&&c._container.appendChild(e)},f.prototype._bindLayerState=function(e,t,a,n){var o=this,r=o._getAllAzLayers(e,t),i=o._itemChanged.bind(o,e,r,t,a,!0);a instanceof HTMLOptionElement?a.parentElement.addEventListener("change",i):(a.onchange=i,n&&(a.oninput=i)),o._itemChanged(e,r,t,a,!1)},f.prototype._createDropdown=function(a,e){var n=this,o=document.createElement("select");return o.className="atlas-layer-dropdown",o.title=e,a.items&&(o.name=R.uuid(),a.items.forEach(function(e){var t=document.createElement("option");e.label&&(t.innerHTML=R.getString(e.label,n._options.resx)),e.enabled&&(t.selected=!0),R.setZoomRangeAttr(e,t),o.appendChild(t),n._bindLayerState(e,a,t)})),o},f.prototype._createChoiceGroup=function(o,r){var i=this,l=document.createElement("div");if(r.items){var e=r.items,s=R.uuid();e.forEach(function(e){var t=document.createElement("label");t.className="atlas-layer-"+o;var a=document.createElement("input");"radio"===(a.type=o)&&(a.name=s),a.checked=e.enabled,t.appendChild(a);var n=document.createElement("span");n.innerHTML=R.getString(e.label,i._options.resx),t.appendChild(n),i._bindLayerState(e,r,a),R.setZoomRangeAttr(e,t),l.appendChild(t)})}return l},f.prototype._createRange=function(d){var c=this,m=document.createElement("div");return d.items&&d.items.forEach(function(e){var t=document.createElement("label");t.className="atlas-layer-range";var a=document.createElement("input");a.type="range";var n=R.getNumber(e,"min",0,0),o=R.getNumber(e,"max",0,1),r=R.getNumber(e,"step",0,.1),i=R.getNumber(e,"value",0,1);a.setAttribute("min",n+""),a.setAttribute("max",o+""),a.setAttribute("step",r+""),a.value=i+"",t.appendChild(a);var l=document.createElement("span"),s=e.label?R.getString(e.label,c._options.resx):"{rangeValue}";l.innerHTML=s.replace("{rangeValue}",new Intl.NumberFormat(void 0,e.numberFormat||{}).format(i)),t.appendChild(l),R.setZoomRangeAttr(e,t),c._bindLayerState(e,d,a,e.updateOnInput),m.appendChild(t)}),m},f.prototype._updateStateCache=function(e,t,a){var n=this,o=n._options.legendControl;if(a instanceof HTMLInputElement&&"radio"===a.type||a instanceof HTMLSelectElement){var r=n._stateCache[a.name];return r&&(r.enabled=!1,r.disabledStyle&&r.layers.forEach(function(e){return n._setLayerStyle(e,r.disabledStyle)}),o&&r.legends&&r.legends.forEach(function(e){o.remove(e)})),n._stateCache[a.name]=e,r}return null},f.prototype._inflateLayerStateStyles=function(e,t){e.enabledStyle&&this._inflateStyle(e.enabledStyle,t),e.disabledStyle&&this._inflateStyle(e.disabledStyle,t),e.style&&this._inflateStyle(e.style,t)},f.prototype._inflateStyle=function(t,e){if(t){var a={},n=Object.keys(t),o=!1,r=!1;e.forEach(function(e){e instanceof i.layer.BubbleLayer?o=!0:e instanceof i.layer.LineLayer&&(r=!0)}),n.forEach(function(e){switch(e){case"color":t.fillColor||(a.fillColor=t.color);break;case"fillColor":t.color||(a.color=t.fillColor),!r||o||t.strokeColor||(a.strokeColor=t.fillColor);break;case"opacity":t.fillOpacity||(a.fillOpacity=t.opacity);break;case"fillOpacity":t.opacity||(a.opacity=t.fillOpacity),!r||o||t.strokeOpacity||(a.strokeOpacity=t.strokeOpacity)}}),Object.assign(t,a)}},f.prototype._setLayerStyle=function(e,t){if(e&&(e=R.getLayer(e,this._map)).setOptions){var a=t;e instanceof i.layer.LineLayer&&(!t.strokeColor&&t.color&&(a=Object.assign({strokeColor:t.color},a)),!t.strokeOpacity&&t.opacity&&(a=Object.assign({strokeOpacity:t.opacity},a))),e.setOptions(a)}},f.prototype._getAllAzLayers=function(e,t){var a=this._map,n=[];return a&&(t&&t.layers&&t.layers.forEach(function(e){n.push(R.getLayer(e,a))}),e?e.layers&&e.layers.forEach(function(e){var t=R.getLayer(e,a);-1===n.indexOf(t)&&n.push(t)}):t.items.forEach(function(e){e.layers&&e.layers.forEach(function(e){var t=R.getLayer(e,a);-1===n.indexOf(t)&&n.push(t)})})),n},f);function f(e){var f=h.call(this,1,"atlas-layer-control-container","atlas-layer-btn")||this;return f._options={resx:{},layout:"list",style:"light",visible:!0,zoomRangeBehavior:"disable",showToggle:!0,minimized:!1},f._stateCache={},f._itemChanged=function(e,t,a,n,o){if(t){var r=f,i=r._options.legendControl,l=r._updateStateCache(e,t,n instanceof HTMLOptionElement?n.parentElement:n);if(n instanceof HTMLInputElement&&"range"===n.type){var s=e,d=parseFloat(n.value),c=s.style;if(c){var m=(e.label?R.getString(e.label,r._options.resx):"{rangeValue}").replace("{rangeValue}",new Intl.NumberFormat(void 0,s.numberFormat||{}).format(d));n.parentElement.children[1].innerHTML=m;var u=R.replacePlaceholder(c,"{rangeValue}",d,!0);t.forEach(function(e){return r._setLayerStyle(e,u)})}s.value=d}else{var g=n.checked||n.selected;n instanceof HTMLOptionElement&&(g=n.parentElement.selectedOptions[0]===n);s=e;var p=g?s.enabledStyle:s.disabledStyle||{};if(p&&t.forEach(function(e){return r._setLayerStyle(e,p)}),s.legends&&i)for(var h=0;h<s.legends.length;h++){var y=s.legends[h];g?(y.minZoom=R.getNumber2(y,s,"minZoom",0,0),y.maxZoom=R.getNumber2(y,s,"minZoom",0,24),i.add(y,0===h&&o)):i.remove(y)}s.enabled=g}r._invokeEvent("statechanged",{type:"statechanged",layerGroup:a,oldState:l,newState:e})}},f.setOptions(Object.assign({},f._options,e)),f}var v=Object.freeze({__proto__:null,LegendControl:g,LayerControl:y}),_=a.merge("atlas.control",v);e.control=_}(this.atlas=this.atlas||{},atlas);
